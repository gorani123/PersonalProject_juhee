<template>
  <div>
    <!-- ìƒë‹¨ë°” ì–‘ì‹ -->
    <div
      class="hero page-inner overlay"
      style="background-image: url('images/hero_bg_3.jpg')"
    >
      <div class="container">
        <div class="row justify-content-center align-items-center">
          <div class="col-lg-9 text-center mt-5">
            <h1 class="heading" data-aos="fade-up">Sell Property</h1>

            <nav
              aria-label="breadcrumb"
              data-aos="fade-up"
              data-aos-delay="200"
            >
              <ol class="breadcrumb text-center justify-content-center">
                <li class="breadcrumb-item"><a href="index.html">Home</a></li>
                <li
                  class="breadcrumb-item active text-white-50"
                  aria-current="page"
                >
                  Upload property
                </li>
              </ol>
            </nav>
          </div>
        </div>
      </div>
    </div>
    <!-- ìƒë‹¨ë°”ì–‘ì‹ ë -->


    
    <div class="section">
  <div class="container">
    <div class="row">
      <div
        class="col-lg-4 mb-5 mb-lg-0"
        data-aos="fade-up"
        data-aos-delay="100"
      >
        <div class="contact-info">
          <div class="address mt-2">
            <i class="icon-room"></i>
            <h4 class="mb-2">Location:</h4>
            <p>
              43 Raymouth Rd. Baltemoer,<br />
              London 3910
            </p>
          </div>

          <div class="open-hours mt-4">
            <i class="icon-clock-o"></i>
            <h4 class="mb-2">Open Hours:</h4>
            <p>
              Sunday-Friday:<br />
              11:00 AM - 2300 PM
            </p>
          </div>

          <div class="email mt-4">
            <i class="icon-envelope"></i>
            <h4 class="mb-2">Email:</h4>
            <p>info@Untree.co</p>
          </div>

          <div class="phone mt-4">
            <i class="icon-phone"></i>
            <h4 class="mb-2">Call:</h4>
            <p>+1 1234 55488 55</p>
          </div>
        </div>
      </div>
      <!-- í¼ ì–‘ì‹ -->
      <div class="col-lg-8" data-aos="fade-up" data-aos-delay="200">
        <form action="#">
          <div class="row">
            <div class="col-6 mb-3">
              <label for="propertyTitle" class="form-label"
              >Property Title</label
            >
            <input
              type="text"
              class="form-control"
              id="propertyTitle"
              required
              name="propertyTitle"
              placeholder="ex) í•´ìš´ëŒ€ ì•„ì´íŒŒí¬"
              v-model="propertyTitle"
            />
            </div>
            <div class="col-6 mb-3">
              <label for="propertyPrice" class="form-label">Price</label>
              <input
                type="text"
                class="form-control"
                id="propertyPrice"
                required
                name="propertyPrice"
                placeholder="ex) 13ì–µ 5000"
                v-model="propertyPrice"
              />
            </div>
            <div class="col-12 mb-3">
              <label for="propertyAddress" class="form-label">Address</label>
              <input
                type="text"
                class="form-control"
                id="propertyAddress"
                required
                name="propertyAddress"
                placeholder="ex) í•´ìš´ëŒ€êµ¬ ë§ˆë¦°ì‹œí‹°2ë¡œ 38"
                v-model="propertyAddress"
              />
            </div>
            <div class="col-12 mb-3">
              <label for="propertyCity" class="form-label">City</label>
              <input
                type="text"
                class="form-control"
                id="propertyCity"
                required
                name="propertyCity"
                placeholder="ex) ë¶€ì‚°ê´‘ì—­ì‹œ"
                v-model="propertyCity"
              />
            </div>
            <div class="col-12 mb-3">
              <label for="propertyBed" class="form-label">Bed</label>
              <input
                type="number"
                class="form-control"
                id="propertyBed"
                required
                name="propertyBed"
                placeholder="ex) 3 "
                v-model="propertyBed"
              />
            </div>
            <div class="col-12 mb-3">
              <div class="mb-4 col-md-3">
                <label for="propertyBath" class="form-label">Bath</label>
                <input
                  type="number"
                  class="form-control"
                  id="propertyBath"
                  required
                  name="propertyBath"
                  placeholder="ex) 1"
                  v-model="propertyBath"
                />
            </div>

       <!-- ì´ë¯¸ì§€ ì„ íƒìƒì ì‹œì‘ -->
       <div class="mb-3 col-md-5">
        <label class="btn btn-default p-0">
          <!-- <!â€” íŒŒì¼ ì„ íƒìƒì â€”> -->
          <input
            type="file"
            accept="image/*"
            ref="file"
            @change="selectProperty"
          />
        </label>
      </div>
      <!-- ì´ë¯¸ì§€ ì„ íƒìƒì ë -->

      <button
      class="btn btn-success btn-sm float-left"
      :disabled="!currentProperty"
      @click="upload"
    >
      Upload
    </button>
    <router-link to="/buy" class="btn btn-success btn-sm float-left"
    >ë“±ë¡í™•ì¸</router-link
  >

         <!-- ë¯¸ë¦¬ë³´ê¸° ì´ë¯¸ì§€ ì‹œì‘ -->
         <div v-if="previewProperty" class="preview">
          <div>
            <img
              width="200"
              class="preview my-3"
              :src="previewProperty"
              alt=""
            />
          </div>
        </div>
        <!-- ë¯¸ë¦¬ë³´ê¸° ì´ë¯¸ì§€ ë -->

                  <!-- ì„œë²„ ì—ëŸ¬ ë©”ì„¸ì§€ê°€ ìˆì„ ê²½ìš° ì•„ë˜ ì¶œë ¥ ì‹œì‘ -->
                  <div v-if="message" class="alert alert-secondary" role="alert">
                    {{ message }}
                  </div>
                  <!-- ì„œë²„ ì—ëŸ¬ ë©”ì„¸ì§€ê°€ ìˆì„ ê²½ìš° ì•„ë˜ ì¶œë ¥ ë -->
                </div>

                
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
<!-- /.untree_co-section -->


  </div>
</template>

<script>
// axios ê³µí†µ í•¨ìˆ˜ import
import PropertyDataService from "../../service/PropertyDataService";

import navbarCom from "../../assets/js/navbar";
import counterCom from "../../assets/js/counter";
import customCom from "../../assets/js/custom";

export default {
  data() {
    return {
      currentProperty: undefined, // í˜„ì¬ ì´ë¯¸ì§€ ë³€ìˆ˜
      previewProperty: undefined, // ë¯¸ë¦¬ë³´ê¸° ì´ë¯¸ì§€ ë³€ìˆ˜
      message: "", // ì„œë²„ìª½ì—ì„œ ì—ëŸ¬ê°€ ë‚  ë•Œ ë³´ë‚´ëŠ” ë©”ì‹œì§€ë¥¼ ì €ì¥í•  ë³€ìˆ˜
      property: [], // ì´ë¯¸ì§€ ê°ì²´ ë°°ì—´(ì—¬ëŸ¬ ê°œ)ì´ ë‚ ì•„ì˜¤ë©´ ì €ì¥ë˜ëŠ” ê³³ğŸ‘€
      searchSelect: "", // ì´ë¦„ìœ¼ë¡œ ê²€ìƒ‰í•˜ëŠ” ë³€ìˆ˜

      // springboot ìš”ì²­í•  ë³€ìˆ˜ , ì´ë¯¸ì§€ëª…(propertyTitle), ë‚´ìš©(content)
      propertyTitle: "",
      propertyPrice: "",
      propertyAddress: "",
      propertyCity: "",
      propertyBed: "",
      propertyBath: "",

      // í˜ì´ì§•ì„ ìœ„í•œ ë³€ìˆ˜ ì •ì˜
      page: 1, // í˜„ì¬ í˜ì´ì§€
      count: 0, // ì „ì²´ ë°ì´í„° ê±´ìˆ˜
      pageSize: 3, // í•œí˜ì´ì§€ë‹¹ ëª‡ê°œë¥¼ í™”ë©´ì— ë³´ì—¬ì¤„ì§€ ê²°ì •í•˜ëŠ” ë³€ìˆ˜

      pageSizes: [3, 6, 9], // select box ì— ë„£ì„ ê¸°ë³¸ ë°ì´í„°
    };
  },
  methods: {
    // ì¡°íšŒ í•¨ìˆ˜
    retrieveProperty() {
      PropertyDataService.getPropertys(
        this.propertyTitle,
        this.page - 1,
        this.pageSize
      ) // í”„ì—” ìë™ í˜ì´ì§•ì²˜ë¦¬ê°€ 1ë¶€í„° ì‹œì‘í•˜ë¯€ë¡œ -1í•´ì„œ 0ìœ¼ë¡œ ë§Œë“¤ì–´ ì¤Œ(ìŠ¤í”„ë§ë¶€íŠ¸ëŠ” 0ë²ˆë¶€í„° ë§¤ê¸°ë‹ˆê¹Œ ë§ì¶°ì¤Œ)
        //  axiosì„±ê³µí•˜ë©´ ìŠ¤í”„ë§ë¶€íŠ¸ ê²°ê³¼ê°€ .then() ì•ˆìœ¼ë¡œ ì „ì†¡ë¨
        .then((response) => {
          // const(let){ì†ì„±ëª…, ì†ì„±ëª…2} = ë°ì´í„°ê°ì²´ë°°ì—´  : ëª¨ë˜ìë°”ìŠ¤í¬ë¦½íŠ¸ ë¬¸ë²• êµ¬ì¡°ë¶„í•´í• ë‹¹
          const { property, totalItems } = response.data; //  springboot ì—ì„œ ì „ì†¡ëœ ë§µ(map) ì •ë³´
          this.property = property; // ìŠ¤í”„ë§ë¶€íŠ¸ì—ì„œ ì „ì†¡í•œ ë°ì´í„°
          this.count = totalItems; // ìŠ¤í”„ë§ë¶€íŠ¸ì—ì„œ ì „ì†¡í•œ í˜ì´ì§€ì •ë³´(ì´ ê±´ìˆ˜)
          // ë””ë²„ê¹… ì½˜ì†”ì— ì •ë³´ ì¶œë ¥
          console.log(response.data);
        })
        // ì‹¤íŒ¨í•˜ë©´ .catch() ì— ì—ëŸ¬ê°€ ì „ì†¡ë¨
        .catch((e) => {
          console.log(e);
        });
    },
    // íŒŒì¼ ì„ íƒìƒìì—ì„œ ì„ íƒí•œ ì´ë¯¸ì§€ë¥¼ ì €ì¥í•˜ëŠ” í•¨ìˆ˜
    selectProperty() {
      // ì²«ë²ˆì§¸ ì„ íƒí•œ ì´ë¯¸ì§€ë¥¼ ë³€ìˆ˜ì— ì €ì¥
      //  this.$refs : htmlì—ì„œ $refs ì†ì„±ì´ ìˆëŠ” ì»¨íŠ¸ë¡¤ì´ ì„ íƒë¨(ë°”ë¡œì ‘ê·¼ê°€ëŠ¥)_ì´ë¯¸ì§€ ì„ íƒìƒìì˜ inputë°•ìŠ¤ì— ref ê±¸ë ¤ìˆìŒ(ref="property")
      //               refs.property ì¤‘ì— ì´ë¦„ì´ Propertysì¸ ì•  ì„ íƒ
      this.currentProperty = this.$refs.file.files.item(0); // ë°°ì—´ ì¤‘ ì²«ë²ˆì§¸ ì„ íƒí•œ ì´ë¯¸ì§€(0)ë¥¼ í˜„ì¬ ì´ë¯¸ì§€ ë³€ìˆ˜
      // .createObjectURL() : ì´ë¯¸ì§€ ì£¼ì†Œë§Œ ì°¸ì¡°í•´ì„œ ì´ë¯¸ì§€ ë³´ì—¬ì£¼ê¸° í•¨ìˆ˜
      this.previewProperty = URL.createObjectURL(this.currentProperty);
      this.message = "";
    },
    //  upload í•¨ìˆ˜ : ë³€ìˆ˜ 7ê°œì˜ ë°ì´í„°ë¥¼ axiosë¥¼ í†µí•´ ì €ì¥ğŸ˜¦
    upload() {
      PropertyDataService.upload(
        this.propertyTitle,
        this.currentProperty,
        this.propertyPrice,
        this.propertyAddress,
        this.propertyCity,
        this.propertyBed,
        this.propertyBath
      )
        // insert ì„±ê³µ then()
        .then((response) => {
          // ì„œë²„ìª½ ì„±ê³µ ë©”ì„¸ì§€ë¥¼ ì €ì¥
          this.message = response.data.message;

          // ê²€ìƒ‰ : ì¬ì¡°íšŒ ìš”ì²­(axios ì¡°íšŒí•¨ìˆ˜ .getPropertys()) : ë°ì´í„° ì˜ ë“¤ì–´ì™”ëŠ”ì§€ í™”ë©´ì— ì¶œë ¥ ìš”ì²­
          return PropertyDataService.getPropertys(
            (this.searchSelect = "Title"), // searchSelect ì— title ì„ íƒí•œ ê²ƒ. ì¡°ê±´ ëŒ€ì‘ ğŸ¥¶
            this.propertyTitle, // proprtyTitle ì¡°ê±´ ëŒ€ì‘
            this.page - 1,
            this.pageSize
          );
        })
        // ì¡°íšŒê°€ ì„±ê³µí•˜ë©´ ì‹¤í–‰ë˜ëŠ” then()
        .then((response2) => {
          const { property, totalItems } = response2.data;
          this.property = property;
          this.count = totalItems;
          console.log(response2.data);
        })
        .catch((e) => {
          console.log(e);
          // ì„œë²„ ìª½ì—ì„œ ì‹¤íŒ¨ ë©”ì‹œì§€ë¥¼ ë°›ì•„ì„œ í™”ë©´ì— ì¶œë ¥
          this.message = "Could not upload the image!!   " + e;
          this.currentProperty = undefined;
        });
    },
    // // select box ê°’ ë³€ê²½ì‹œ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜(ì¬ì¡°íšŒ)
    // handlePageSizeChange(event) {
    //   this.pageSize = event.target.value; // í•œí˜ì´ì§€ë‹¹ ê°œìˆ˜ ì €ì¥(3, 6, 9)
    //   this.page = 1;
    //   // ì¬ì¡°íšŒ í•¨ìˆ˜ í˜¸ì¶œ
    //   this.retrieveProperty();
    // },
    // // í˜ì´ì§€ ë²ˆí˜¸ ë³€ê²½ì‹œ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜(ì¬ì¡°íšŒ)
    // handlePageChange(value) {
    //   this.page = value; // ë§¤ê°œë³€ìˆ˜ê°’ìœ¼ë¡œ í˜„ì¬í˜ì´ì§€ ë³€ê²½
    //   // ì¬ì¡°íšŒ í•¨ìˆ˜ í˜¸ì¶œ
    //   this.retrieveProperty();
    // },
    // // pnoë¡œ ì‚­ì œí•˜ëŠ” í•¨ìˆ˜
    // deleteImage(pno) {
    //   // axios ê³µí†µí•¨ìˆ˜ í˜¸ì¶œ
    //   PropertyDataService.delete(pno)
    //     // ì„±ê³µí•˜ë©´ then() ê²°ê³¼ê°€ ì „ì†¡ë¨
    //     .then((response) => {
    //       console.log(response);
    //       // ì²«í˜ì´ì§€(ì „ì²´ëª©ë¡_ì¡°íšŒ_í˜ì´ì§€) ê°•ì œ ì´ë™ : /property
    //       this.message = "ì •ìƒì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.";
    //       // ì‚­ì œ í›„ ì¬ì¡°íšŒ
    //       this.retrieveProperty();
    //     })
    //     // ì‹¤íŒ¨í•˜ë©´ .catch() ì—ëŸ¬ë©”ì„¸ì§€ê°€ ì „ì†¡ë¨
    //     .catch((e) => {
    //       console.log(e);
    //       this.message = "ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤." + e.message;
    //     });
    // },
  },
  // í™”ë©´ì´ ëœ¨ì ë§ˆì ì‹¤í–‰ë˜ëŠ” ì´ë²¤íŠ¸ - ì „ì²´ì¡°íšŒ í•¨ìˆ˜ retrieveProperty() ì‹¤í–‰
  mounted() {
    // this.retrieveProperty();
    navbarCom();
    counterCom();
    customCom();
  },
};
</script>

<style>
.preview{
  width: 200px;
  height: 150px;
}
</style>
